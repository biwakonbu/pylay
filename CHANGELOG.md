# CHANGELOG

## [0.3.0] - 2025年10月

### 新機能
- **型定義レベル分析・監視機能** (#24): Python 3.13の型定義レベル（Level 1/2/3）を自動分類・分析する機能を実装
  - **3段階の型レベル分類**: `type`エイリアス（Level 1）、`Annotated`+バリデータ（Level 2）、`BaseModel`（Level 3）を自動検出
  - **型レベルアップ推奨エンジン**: 使用状況とパターン分析に基づく自動的な型昇格/降格推奨
  - **ドキュメント品質分析**: docstringの実装率、詳細度、総合品質スコアを算出
  - **カスタム閾値設定**: 型レベル比率とドキュメント品質の警告閾値をカスタマイズ可能
  - **Rich統合のCLI出力**: 美しいテーブル形式での統計表示と優先度付き推奨事項
  - **analyze-typesコマンド**: トップレベルCLIコマンドとして型レベル分析を実行
- **Analyzerアーキテクチャの導入**: `src/core/analyzer/` を新規作成し、解析エンジンを独立化
- **高度な型推論と依存抽出**: mypy + AST + NetworkXを活用した包括的な解析機能
- **循環依存検出**: 依存グラフから自動的に循環を検出・報告
- **視覚化機能**: 依存関係をPNG/PDF/DOT形式で自動生成
- **柔軟な解析モード**: `types_only`, `deps_only`, `full` の3モードを選択可能
- **GraphProcessor**: グラフメトリクス計算とYAML/GraphMLエクスポート機能を追加

### 改善
- **型参照カウントの精度向上**: AST解析による正確な型使用回数カウント（型エイリアス定義内の参照も検出）
- **型エイリアス検出の強化**: `type`文と代入形式（`TypeAlias = ...`）の両方をサポート
- **型定義重複除去**: ファイルパス・名前・行番号の組み合わせキーによる正確な重複判定
- **docstring分析の充実**: Google/NumPy/reStructuredText形式の検出と詳細度スコアリング
- **TypeReporterのコード品質**: docstring充実化、エッジケース処理の明確化、防御的プログラミングの実践
- **疎結合アーキテクチャ**: 解析部分を他のコンポーネントから独立させ、拡張性を向上
- **型安全性強化**: Pydanticで型安全性を維持しつつ、柔軟な依存処理を実現
- **CLI/TUI強化**: `infer-deps` コマンドと `--mode` オプションを追加
- **ドキュメント自動生成**: 解析結果にグラフ情報（循環、統計）を自動追加
- **テストスイート拡張**: `test_analyzer.py` を追加し、19テストで完全網羅

### 修正
- **型エイリアス参照カウント**: `visit_TypeAlias`メソッド追加により、型エイリアス定義内の型参照を正しくカウント
- **閾値設定の修正**: `threshold_ratios`から型レベル閾値とドキュメント閾値を正しく分離・適用
- **未使用型判定の修正**: 型使用回数カウントをAST解析ベースに改善し、誤判定を解消
- **削除推奨から調査推奨へ**: プロジェクトポリシーに基づき、未使用型は削除ではなく調査対象として推奨
- **型チェックエラー修正**: Pyright/mypyの厳格モード下での全エラーを解消
- **コンソール出力の改善**: 末尾の`None`表示削除、テーブルスタイルの統一、色の一貫性向上
- **CIエラー修正**: テストのimportエラーとNetworkX依存を適切に処理
- **構文エラー修正**: `src/infer_deps.py` のtry-except構造を修正
- **カバレッジ向上**: 78% → 80%目標に近づくテスト追加

### 技術的改善
- **`from __future__ import annotations`の導入**: 文字列リテラル型アノテーションを削除し、Python 3.13標準構文に統一
- **AST Visitor パターン**: `_TypeReferenceCounter`による効率的な型参照カウント（関数引数、戻り値、変数アノテーション、クラス定義、型エイリアス）
- **3つのレベル判定ロジック**: パターンマッチング、使用回数、docstring指示を統合した高度な判定エンジン
- **Makefileコマンド追加**: `make analyze`で型レベル分析を簡単に実行可能
- **NetworkX統合**: グラフ分析機能を標準化（未インストール時も基本動作OK）
- **依存関係管理**: analyzerモジュールの循環import回避
- **エラーハンドリング**: NetworkX/Pydot未インストール時の適切なフォールバック

---

## [0.2.0] - 2025年1月

### 新機能
- **pyproject.toml設定駆動のディレクトリ丸ごと解析機能**: Issue #5 に対応し、設定ファイルに基づく包括的な型解析・ドキュメント生成機能を追加
- **--cleanオプション**: プロジェクト解析時に出力ディレクトリをクリーンアップする機能を追加
- **OutputPathManager**: 出力ファイル管理を統一し、より堅牢なパス管理を実現

### 改善
- **開発者ガイドの簡素化**: プロジェクトの概念とアーキテクチャを明確に整理
- **docs/ディレクトリの整理**: 散らばった古いYAMLファイルを削除し、出力ディレクトリを`docs/pylay-types/`に統一
- **CIテストエラー修正**: 継続的インテグレーションの安定性を向上

### 修正
- **型解析とテストの修正**: 型推論の精度向上とテストケースの拡充

### 技術的改善
- **バージョン0.2.0**: 安定版リリースに向けたバージョンアップデート
- **依存関係管理**: pyproject.tomlでの設定統一
- **コードベースのクリーンアップ**: 不要ファイルの整理と構造最適化

---

*このCHANGELOGは、[Keep a Changelog](https://keepachangelog.com/ja/1.0.0/)の形式に従っています。*
