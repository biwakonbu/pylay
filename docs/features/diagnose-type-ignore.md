# type: ignore è¨ºæ–­æ©Ÿèƒ½

## æ¦‚è¦

`diagnose-type-ignore` ã‚³ãƒãƒ³ãƒ‰ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ `# type: ignore` ã‚³ãƒ¡ãƒ³ãƒˆã®åŸå› ã‚’è‡ªå‹•çš„ã«ç‰¹å®šã—ã€å…·ä½“çš„ãªè§£æ±ºç­–ã‚’ææ¡ˆã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚

## èƒŒæ™¯ã¨ç›®çš„

`# type: ignore` ã‚³ãƒ¡ãƒ³ãƒˆã¯å‹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼ã‚’ä¸€æ™‚çš„ã«å›é¿ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ãŒã€ä»¥ä¸‹ã®èª²é¡ŒãŒã‚ã‚Šã¾ã—ãŸï¼š

1. **åŸå› ã®ä¸æ˜ç¢ºã•**: ãªãœå‹ãƒã‚§ãƒƒã‚¯ã‚’å›é¿ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸã®ã‹ãŒä¸æ˜
2. **æŠ€è¡“çš„è² å‚µã®è“„ç©**: æ”¾ç½®ã•ã‚ŒãŸ type: ignore ãŒå¢—åŠ ã—ã€å‹å®‰å…¨æ€§ãŒä½ä¸‹
3. **è§£æ±ºæ–¹æ³•ã®ä¸æ˜ç¢ºã•**: ã©ã®ã‚ˆã†ã«ä¿®æ­£ã™ã¹ãã‹åˆ†ã‹ã‚‰ãªã„

ã“ã®æ©Ÿèƒ½ã«ã‚ˆã‚Šã€å‹å®‰å…¨æ€§ã®å‘ä¸Šã¨æŠ€è¡“çš„è² å‚µã®å‰Šæ¸›ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

## ä¸»ãªæ©Ÿèƒ½

### 1. è‡ªå‹•æ¤œå‡º
- æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹ `# type: ignore` ã‚³ãƒ¡ãƒ³ãƒˆã®æ¤œå‡º
- ignoreç¨®åˆ¥ã®è­˜åˆ¥ï¼ˆ`call-arg`, `arg-type`, `general` ãªã©ï¼‰

### 2. åŸå› ç‰¹å®š
- mypyå®Ÿè¡Œã«ã‚ˆã‚‹å‹ã‚¨ãƒ©ãƒ¼æƒ…å ±ã®å–å¾—
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨è¡Œç•ªå·ã®ç´ä»˜ã‘
- ASTè§£æã«ã‚ˆã‚‹åŸå› å¼ã®ç‰¹å®š

### 3. å„ªå…ˆåº¦åˆ¤å®š
å•é¡Œã‚’3æ®µéšã§åˆ†é¡ï¼š

- **HIGH**: Anyå‹ã®å¤šç”¨ã€é‡è¦ãªå‹ãƒã‚§ãƒƒã‚¯å›é¿
- **MEDIUM**: å±€æ‰€çš„ãªå‹ã‚¨ãƒ©ãƒ¼ï¼ˆå¼•æ•°ãƒ»æˆ»ã‚Šå€¤ï¼‰
- **LOW**: æ—¢çŸ¥ã®åˆ¶ç´„ï¼ˆPydanticå‹•çš„å±æ€§ç­‰ï¼‰

### 4. è§£æ±ºç­–ææ¡ˆ
ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«å¿œã˜ãŸå…·ä½“çš„ãªä¿®æ­£æ–¹æ³•ã‚’æç¤ºï¼š

- **Pydanticé–¢é€£**: `model_construct()` ã‚„ `TypedDict` ã®ä½¿ç”¨
- **dictå‹ã‚¢ã‚¯ã‚»ã‚¹**: Pydanticãƒ¢ãƒ‡ãƒ«ã§ã®ç›´æ¥æ“ä½œ
- **call-arg**: å‹ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®è¿½åŠ 
- **æ±ç”¨çš„**: ã‚­ãƒ£ã‚¹ãƒˆã‚„ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 

## ä½¿ç”¨æ–¹æ³•

### CLIã‚³ãƒãƒ³ãƒ‰

#### åŸºæœ¬çš„ãªä½¿ã„æ–¹
```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’è¨ºæ–­
pylay diagnose-type-ignore

# ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨ºæ–­
pylay diagnose-type-ignore --file src/core/converters/type_to_yaml.py

# é«˜å„ªå…ˆåº¦ã®ã¿è¡¨ç¤º
pylay diagnose-type-ignore --priority high

# è§£æ±ºç­–ã‚’å«ã‚€è©³ç´°è¡¨ç¤º
pylay diagnose-type-ignore --solutions

# JSONå½¢å¼ã§å‡ºåŠ›
pylay diagnose-type-ignore --format json --output report.json
```

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä¸€è¦§

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ |
|----------|------|
| `--file`, `-f` | è§£æå¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæŒ‡å®šã—ãªã„å ´åˆã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ï¼‰ |
| `--priority`, `-p` | è¡¨ç¤ºã™ã‚‹å„ªå…ˆåº¦ï¼ˆhigh/medium/low/allã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: allï¼‰ |
| `--solutions`, `-s` | è§£æ±ºç­–ã‚’è¡¨ç¤º |
| `--format` | å‡ºåŠ›å½¢å¼ï¼ˆconsole/jsonã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: consoleï¼‰ |
| `--output`, `-o` | å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ï¼ˆformat=jsonã®å ´åˆã«ä½¿ç”¨ï¼‰ |

### Makeã‚¿ãƒ¼ã‚²ãƒƒãƒˆ

é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«ç°¡å˜ã«çµ±åˆã§ãã‚‹Makeã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’æä¾›ï¼š

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’è¨ºæ–­
make diagnose-ignore

# ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨ºæ–­ï¼ˆFILEå¤‰æ•°ã§æŒ‡å®šï¼‰
make diagnose-ignore-file FILE=src/cli/analyze_issues.py

# é«˜å„ªå…ˆåº¦ã®ã¿è¨ºæ–­
make diagnose-ignore-high
```

## å‡ºåŠ›ä¾‹

### ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›

```
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Type Ignore Diagnostics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

src/cli/analyze_issues.py

  MEDIUM     Line 270     type: ignore[general]

  Cause     å‹ãƒã‚§ãƒƒã‚¯ã‚’å›é¿: general
  Detail    dictå‹ã®å€¤ã‚¢ã‚¯ã‚»ã‚¹ã§å‹ãŒä¸æ˜ç¢º

  Code

  267         print(f"âš ï¸ å•é¡Œã®ã‚ã‚‹ãƒã‚§ãƒƒã‚¯: {issues}/{total}")
  268
  269         print("\nğŸ“‹ è©³ç´°çµæœ:")
â± 270         for result in summary["results"]:  # type: ignore
  271             status = (
  272                 "âœ…"
  273                 if result["success"] and not result["has_issues"]

  Solution
    â€¢ Pydanticãƒ¢ãƒ‡ãƒ«ã®ã¾ã¾æ“ä½œï¼ˆmodel_dump()ã‚’ä½¿ã‚ãªã„ï¼‰
    â€¢ TypedDictå½¢å¼ã®ã‚¹ã‚­ãƒ¼ãƒã‚’è¿½åŠ 

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Summary by Priority


  Priority   Category                           Count    Ratio
 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  HIGH       Anyã®å¤šç”¨ã€é‡è¦ãªå‹ãƒã‚§ãƒƒã‚¯å›é¿        0     0.0%
  MEDIUM     å±€æ‰€çš„ãªå‹ã‚¨ãƒ©ãƒ¼ï¼ˆå¼•æ•°ãƒ»æˆ»ã‚Šå€¤ï¼‰       4   100.0%
  LOW        æ—¢çŸ¥ã®åˆ¶ç´„ï¼ˆPydanticå‹•çš„å±æ€§ç­‰ï¼‰       0     0.0%
             Total                                  4     100%
```

### JSONå‡ºåŠ›

```json
[
  {
    "file_path": "src/cli/analyze_issues.py",
    "line_number": 270,
    "ignore_type": "general",
    "cause": "å‹ãƒã‚§ãƒƒã‚¯ã‚’å›é¿: general",
    "detail": "dictå‹ã®å€¤ã‚¢ã‚¯ã‚»ã‚¹ã§å‹ãŒä¸æ˜ç¢º",
    "code_context": {
      "before_lines": ["..."],
      "target_line": "for result in summary[\"results\"]:  # type: ignore",
      "after_lines": ["..."],
      "line_number": 270
    },
    "priority": "MEDIUM",
    "solutions": [
      "Pydanticãƒ¢ãƒ‡ãƒ«ã®ã¾ã¾æ“ä½œï¼ˆmodel_dump()ã‚’ä½¿ã‚ãªã„ï¼‰",
      "TypedDictå½¢å¼ã®ã‚¹ã‚­ãƒ¼ãƒã‚’è¿½åŠ "
    ]
  }
]
```

## æŠ€è¡“è©³ç´°

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        diagnose-type-ignore CLI         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       TypeIgnoreAnalyzer                â”‚
â”‚  - type: ignoreæ¤œå‡º                     â”‚
â”‚  - mypyå®Ÿè¡Œã¨å‹ã‚¨ãƒ©ãƒ¼å–å¾—               â”‚
â”‚  - å„ªå…ˆåº¦åˆ¤å®š                           â”‚
â”‚  - è§£æ±ºç­–ç”Ÿæˆ                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       TypeIgnoreReporter                â”‚
â”‚  - Richãƒ™ãƒ¼ã‚¹ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›           â”‚
â”‚  - JSONå½¢å¼ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

#### TypeIgnoreIssue
```python
class TypeIgnoreIssue(BaseModel):
    file_path: FilePath
    line_number: LineNumber
    ignore_type: str  # e.g., "call-arg", "general"
    cause: str
    detail: str
    code_context: CodeContext
    priority: Priority  # "HIGH" | "MEDIUM" | "LOW"
    solutions: list[str]
```

#### TypeIgnoreSummary
```python
class TypeIgnoreSummary(BaseModel):
    total_count: int
    high_priority_count: int
    medium_priority_count: int
    low_priority_count: int
    by_category: dict[str, int]
```

### å„ªå…ˆåº¦åˆ¤å®šã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

```python
def _determine_priority(
    ignore_type: str,
    code_context: CodeContext,
    errors: list[dict[str, str]],
) -> Priority:
    # HIGH: Anyå‹ã®å¤šç”¨ã€é‡è¦ãªå‹ãƒã‚§ãƒƒã‚¯å›é¿
    if "Any" in target and ignore_type in ["assignment", "arg-type", "return-value"]:
        return "HIGH"

    # MEDIUM: å±€æ‰€çš„ãªå‹ã‚¨ãƒ©ãƒ¼
    if ignore_type in ["call-arg", "arg-type", "attr-defined"]:
        return "MEDIUM"

    # LOW: æ—¢çŸ¥ã®åˆ¶ç´„ï¼ˆPydanticå‹•çš„å±æ€§ç­‰ï¼‰
    if "BaseModel" in target or "model_construct" in target:
        return "LOW"

    return "MEDIUM"
```

## ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

### 1. æŠ€è¡“çš„è² å‚µã®å¯è¦–åŒ–
```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®type: ignoreã‚’è¨ºæ–­
make diagnose-ignore

# çµæœã‚’JSONå½¢å¼ã§ä¿å­˜
pylay diagnose-type-ignore --format json --output tech-debt.json
```

### 2. å„ªå…ˆçš„ãªä¿®æ­£å¯¾è±¡ã®ç‰¹å®š
```bash
# é«˜å„ªå…ˆåº¦ã®å•é¡Œã®ã¿è¡¨ç¤º
make diagnose-ignore-high

# çµæœã‚’å…ƒã«è¨ˆç”»çš„ã«ä¿®æ­£
```

### 3. ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã®æ´»ç”¨
```bash
# PRã§è¿½åŠ ã•ã‚ŒãŸtype: ignoreã‚’è¨ºæ–­
pylay diagnose-type-ignore --file path/to/changed_file.py --solutions

# è§£æ±ºç­–ã‚’å‚è€ƒã«ä¿®æ­£
```

### 4. CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¸ã®çµ±åˆ
```yaml
# .github/workflows/type-check.yml
- name: Diagnose type: ignore
  run: |
    pylay diagnose-type-ignore --format json --output type-ignore-report.json
    # ãƒ¬ãƒãƒ¼ãƒˆã‚’ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã¨ã—ã¦ä¿å­˜
```

## æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

1. **å‹å®‰å…¨æ€§ã®å‘ä¸Š**: type: ignore ã®é©åˆ‡ãªå‰Šæ¸›ã«ã‚ˆã‚Šå‹å®‰å…¨æ€§ãŒå‘ä¸Š
2. **æŠ€è¡“çš„è² å‚µã®å‰Šæ¸›**: æ”¾ç½®ã•ã‚ŒãŸ type: ignore ã®åŸå› ãŒæ˜ç¢ºåŒ–ã•ã‚Œã€è¨ˆç”»çš„ãªè§£æ¶ˆãŒå¯èƒ½
3. **é–‹ç™ºè€…ä½“é¨“ã®å‘ä¸Š**: å…·ä½“çš„ãªè§£æ±ºç­–ã«ã‚ˆã‚Šã€ä¿®æ­£ãŒå®¹æ˜“ã«
4. **ã‚³ãƒ¼ãƒ‰å“è³ªã®å¯è¦–åŒ–**: å„ªå…ˆåº¦åˆ¥ã®é›†è¨ˆã«ã‚ˆã‚Šã€å•é¡Œã®é‡è¦åº¦ãŒä¸€ç›®ç­ç„¶

## ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

- [ ] pyrightçµ±åˆã«ã‚ˆã‚‹å‹ã‚¨ãƒ©ãƒ¼æƒ…å ±ã®å……å®Ÿ
- [ ] è‡ªå‹•ä¿®æ­£æ©Ÿèƒ½ï¼ˆ`--fix` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- [ ] CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¸ã®çµ±åˆã‚µãƒ³ãƒ—ãƒ«
- [ ] HTMLå½¢å¼ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ
- [ ] å‹ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å­¦ç¿’ã¨ææ¡ˆç²¾åº¦ã®å‘ä¸Š

## é–¢é€£ãƒªãƒ³ã‚¯

- [Issue #36](https://github.com/biwakonbu/pylay/issues/36)
- [PR #43](https://github.com/biwakonbu/pylay/pull/43)
- [å‹å®šç¾©ãƒ«ãƒ¼ãƒ«](../typing-rule.md)
